<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, minimal-ui"><meta name="robots" content="none"><title>marlou knowledge base</title><link href="/github-markdown.7d1fca7c.css" rel="stylesheet" media="all"><link href="/main.4b9cca7f.css" rel="stylesheet" media="all"><link href="/github.8c766760.css" rel="stylesheet"><script src="/docs.82f7552b.js"></script></head><body><article class="markdown-body"><h1 id="title-nodejs---mock-management-via-expressjs">nodejs - mock management via expressjs</h1>
<p>The idea is to add a real nodejs rest server in the front project.</p>
<h2 id="title-the-gulp-task">the gulp task</h2>
<pre><code class="lang-javascript">// write this in your gulp files
var gulp = require(&#39;gulp&#39;); // 3.9.1
var gls = require(&#39;gulp-live-server&#39;); // 0.0.28

gulp.task(&#39;server-rest-mock&#39;, function() {
    var server = gls.new([&#39;app.js&#39;]);
    server.start();
});</code></pre>
<h2 id="title-appjs---the-rest-server"><code>/app.js</code> - the rest server</h2>
<p>Your server source code is in <code>/server</code></p>
<pre><code class="lang-javascript">&#39;use strict&#39;;

var express = require(&#39;express&#39;); // 4.13.3
var bodyParser = require(&#39;body-parser&#39;); // 1.14.0
var common = require(&#39;./server/common&#39;);
var fs = require(&#39;fs&#39;); // 0.0.2

var context = &#39;project-name&#39;;

var app = module.exports = express();
app.use(bodyParser.json());
app.use(&#39;/node_modules&#39;, express.static(__dirname + &#39;/node_modules&#39;));

// to serve also the webapp
app.use(&#39;/&#39; + context, express.static(__dirname + &#39;/src&#39;));

var serverApp = app.listen(3001, function () {
    console.log(&#39;App listening at http://%s:%s/%s&#39;, &#39;localhost&#39;, serverApp.address().port, context);
});

// the core server files
require(&#39;./server/debug&#39;)(app);
require(&#39;./server/cors&#39;)(app);
require(&#39;./server/logger&#39;)(app);

// rest impl
require(&#39;./server/example/example&#39;)(app);</code></pre>
<h2 id="title-serverdebugjs---to-ping-the-server"><code>/server/debug.js</code> - to ping the server</h2>
<pre><code class="lang-javascript">&#39;use strict&#39;;

module.exports = function(app)
{
    app.get(&#39;/rest/debug/ping&#39;, function (req, res) {
        var result = {code: 200, message:&#39;ok&#39;};
        res.json(result);
    });
};</code></pre>
<h2 id="title-servercorsjs---to-add-cors-support"><code>/server/cors.js</code> - to add CORS support</h2>
<pre><code class="lang-javascript">&#39;use strict&#39;;

module.exports = function (app) {
    app.use(function(req, res, next) {
        res.header(&quot;Access-Control-Allow-Origin&quot;, &quot;*&quot;);
        res.header(&quot;Access-Control-Allow-Headers&quot;, &quot;Origin, X-Requested-With, Content-Type, Accept, If-Modified-Since&quot;);
        next();
    });
};</code></pre>
<h2 id="title-serverloggerjs---to-display-http-request-in-the-gulp-task-console"><code>/server/logger.js</code> - to display http request in the gulp task console</h2>
<pre><code class="lang-javascript">&#39;use strict&#39;;

module.exports = function (app) {
    app.use(function (req, res, next) {
        console.log(new Date(Date.now()).toLocaleString() + &#39; &#39; + req.url);
        next();
    });
};</code></pre>
<h2 id="title-servercommonjs---to-add-custom-utils-methods"><code>/server/common.js</code> - to add custom utils methods</h2>
<pre><code class="lang-javascript">&#39;use strict&#39;;

String.prototype.isEmpty = function () {
    return this.length === 0;
};

String.prototype.equalsIgnoreCaseWhiteSpace = function (other) {
    return this.toLowerCase().trim() === other.toLowerCase().trim();
};

String.prototype.contains = function (stringToCheck) {
    return this.indexOf(stringToCheck) &gt; -1;
};

Array.prototype.limitTo = function (int) {
    int = int || 3;
    return this &amp;&amp; this.slice(0, int);
};

Array.prototype.contain=function (value) {
    return this &amp;&amp; this.indexOf(value) &gt; -1;
};

exports.randomTime = function () {
    var min = 1000;
    var max = 2000;

    if (min &lt; 0) {
        return min + Math.random() * (Math.abs(min) + max);
    } else {
        return min + Math.random() * max;
    }
};</code></pre>
<h2 id="title-serverexampleexamplejs---ws-impl-example"><code>/server/example/example.js</code> - WS impl example</h2>
<pre><code class="lang-javascript">&#39;use strict&#39;;

var common = require(&#39;../common&#39;);
var fs = require(&quot;fs&quot;);
var data = JSON.parse(fs.readFileSync(&#39;./server/example/example-data.json&#39;, &#39;utf8&#39;));

module.exports = function (app) {
    app.get(&#39;/rest/example/:id/data&#39;, function (req, res) {

        if(!req.query) {
            setTimeout(function() {
                res.status(400).send(&#39;Bad Request&#39;);
            }, common.randomTime());

            return;
        }

        var id = req.params.id;
        if(!id) {
            setTimeout(function() {
                res.status(400).send(&#39;Bad Request : id missing&#39;);
            }, common.randomTime());

            return;
        }

        setTimeout(function() {
            res.json(data);
        }, common.randomTime());
    });
};</code></pre>
</article></body></html>
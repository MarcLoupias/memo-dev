<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, minimal-ui"><meta name="robots" content="none"><title>marlou knowledge base</title><link href="/github-markdown.d098492d.css" rel="stylesheet" media="all"><link href="/main.cb64a04a.css" rel="stylesheet" media="all"><link href="/github.51c27d45.css" rel="stylesheet"><script src="/docs.a0c71561.js"></script></head><body><article class="markdown-body"><h1 id="title-nodejs---module-system">nodejs - module system</h1> <p><a href="https://blog.risingstack.com/node-js-at-scale-module-system-commonjs-requirhtml">How the module system, CommonJS &amp; require works</a></p> <p><a href="https://nodejs.org/dist/latest-v6.x/docs/api/modules.hthtml">Node.js v6.11.2 Documentation - Modules</a></p> <p>Node.js module system is based on the <a href="http://wiki.commonjs.org/wiki/Commonhtml">CommonJS spec</a>.</p> <p><a href="https://medium.com/dailyjs/es6-modules-node-js-and-the-michael-jackson-solution-828dc244bhtml">ES6 modules, Node.js and the Michael Jackson Solution</a></p> <blockquote> <ul> <li>CommonJS to the rescue</li> <li>How ES6 modules work and why Node.js hasn’t implemented it yet</li> <li>A note about Babel</li> <li>Why ES6 modules are good and how to get the best of both worlds</li> </ul> </blockquote> <h2 id="title-articles">articles</h2> <p><a href="https://stackoverflow.com/questions/42401079/nodejs-requihtml">NodeJS require(‘..’)? : stackoverflow.com</a></p> <p><a href="https://medium.freecodecamp.org/requiring-modules-in-node-js-everything-you-need-to-know-e7fbd119bhtml">Requiring modules in Node.js: Everything you need to know : medium.freecodecamp.org : 20170319</a></p> <h2 id="title-tips--rules">tips &amp; rules</h2> <h3 id="title-module-wrapper">module wrapper</h3> <p>Variables inside a module are private to that module because each module is wrapped.</p> <pre><code class="lang-javascript">(function(exports, require, module, __filename, __dirname) {
// Your module code actually lives in here
});</code></pre> <p>See <a href="https://nodejs.org/dist/latest-v6.x/docs/api/modules.html#modules_the_module_wrapphtml">module wrapper doc section</a> for details.</p> <p>The CommonJS module system uses a <strong>runtime evaluation of the modules</strong>, wrapping them into a function before the execution.</p> <h3 id="title-modules-are-singleton">modules are singleton</h3> <p>Module caching in the <a href="https://nodejs.org/dist/latest-v6.x/docs/api/modules.html#modules_cachihtml">node documentation</a>.</p> <p>Everytime you use <code>require(&#39;awesome-module&#39;)</code>, node returns the same instance. If you want to execute initialization code<br>at each <code>require</code> call, exports a <code>function</code>.</p> <p>Module unicity is based on the directory (<a href="https://nodejs.org/dist/latest-v6.x/docs/api/modules.html#modules_module_caching_caveahtml">see Module Caching Caveats</a>).</p> <h3 id="title-module-types">module types</h3> <p>The <a href="https://nodejs.org/dist/latest-v6.x/docs/api/modules.html#modules_the_module_objehtml"><code>module</code> Object definition</a>.</p> <h4 id="title-core-module">core module</h4> <p>The node builtin modules (<code>http</code>, <code>assert</code>, …).</p> <p>They have priority over others modules. For example if a file module is <code>http.js</code>, <code>require(&#39;http&#39;);</code> will result loading<br>the node <code>http</code> module and not the file.</p> <h4 id="title-file-module">file module</h4> <p>File extension is optional.</p> <p>A required module prefixed with <code>&#39;/&#39;</code> is an absolute path to the file. For example, <code>require(&#39;/home/marco/foo.js&#39;)</code> will load the file at <code>/home/marco/foo.js</code>.</p> <p>A required module prefixed with <code>&#39;./&#39;</code> is relative to the file calling <code>require()</code>. </p> <p>Without a leading <code>&#39;/&#39;</code>, <code>&#39;./&#39;</code>, or <code>&#39;../&#39;</code> to indicate a file, the module must either be a core module or is loaded from a <code>node_modules</code> folder.</p> <h4 id="title-folder-module">folder module</h4> <p>There are three ways in which a folder may be passed to <code>require()</code> as an argument.</p> <h5 id="title-folder-contains-a-default-indexjs">folder contains a default <code>index.js</code></h5> <p>If there is no <code>package.json</code> file present in the directory, then node will attempt to load an <code>index.js</code> out of that directory.</p> <p>For example, if there was no <code>package.json</code> file in the above example, then <code>require(&#39;./some-library&#39;)</code> would attempt to load <code>./some-library/index.js</code>.</p> <h5 id="title-folder-is-defined-with-a-packagejson">folder is defined with a <code>package.json</code></h5> <p>Create a <code>package.json</code> file in the root of the folder, which specifies a main module.</p> <pre><code class="lang-json">{&quot;name&quot;:&quot;some-library&quot;, &quot;main&quot;:&quot;./lib/some-library.js&quot;}</code></pre> <p>If this was in a folder at <code>./some-library</code>, then <code>require(&#39;./some-library&#39;)</code> would attempt to load <code>./some-library/lib/some-library.js</code>.</p> <h5 id="title-folder-is-in-a-node_modules-directory">folder is in a <code>node_modules</code> directory</h5> <p>If node cannot load a default <code>index.js</code> file nor find a <code>package.json</code>, it will search for <code>node_modules</code> directory on the file system.</p> <p>See <a href="https://nodejs.org/dist/latest-v6.x/docs/api/modules.html#modules_loading_from_node_modules_foldehtml">Loading from <code>node_modules</code> Folders</a>.</p> </article></body></html>
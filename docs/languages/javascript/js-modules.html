<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, minimal-ui"><meta name="robots" content="none"><title>marlou knowledge base</title><link href="/github-markdown.7d1fca7c.css" rel="stylesheet" media="all"><link href="/main.4b9cca7f.css" rel="stylesheet" media="all"><link href="/github.8c766760.css" rel="stylesheet"><script src="/docs.a092d0a1.js"></script></head><body><article class="markdown-body"><h1 id="title-javascript---modules">JavaScript - Modules</h1>
<p><strong>sources</strong></p>
<p><a href="https://auth0.com/blog/javascript-module-systems-showdown/">JavaScript Module Systems Showdown: CommonJS vs AMD vs ES2015 - auth0.com/blog - 20160315</a></p>
<p><a href="https://stackoverflow.com/questions/16521471/relation-between-commonjs-amd-and-requirejs">Relation between CommonJS, AMD and RequireJS? - stackoverflow.com - 20130513</a></p>
<p><a href="http://putaindecode.io/fr/articles/frontend/2015-etat-lieux-javascript-modulaire/">JavaScript modulaire pour le front-end : les bases - putaindecode.io - 20141215</a></p>
<p><a href="https://addyosmani.com/writing-modular-js/">Writing Modular JavaScript With AMD, CommonJS &amp; ES Harmony - addyosmani.com - no date</a></p>
<p><a href="https://medium.com/dailyjs/es6-modules-node-js-and-the-michael-jackson-solution-828dc244b8b">ES6 modules, Node.js and the Michael Jackson Solution - medium.com/dailyjs - 20170721</a></p>
<p><a href="https://medium.freecodecamp.org/javascript-modules-a-beginner-s-guide-783f7d7a5fcc">JavaScript Modules: A Beginner’s Guide - Preethi Kasireddy - 20160122</a></p>
<p><a href="http://www.adequatelygood.com/JavaScript-Module-Pattern-In-Depth.html">JavaScript Module Pattern: In-Depth - 20100312</a></p>
<p><a href="https://addyosmani.com/resources/essentialjsdesignpatterns/book/#modulepatternjavascript">The Module Pattern - Learning JavaScript Design Patterns - Addy Osmani 2017</a></p>
<p><a href="https://youtu.be/KJzlllc7Jq8?t=1806">ES6+ maintenant ! (Christophe Porteneuve) - Devoxx2016</a></p>
<p><a href="https://youtu.be/k0_gi7BoBgw?t=475">État de l’art de ES2015+ dans Node.js et le navigateur (Christophe Porteneuve) - Blend Web Mix 2016</a></p>
<p><a href="https://dontkry.com/posts/code/browserify-and-the-universal-module-definition.html">Browserify and the Universal Module Definition - 20130614</a></p>
<p><a href="https://www.leanpanda.com/blog/2015/06/28/amd-requirejs-commonjs-browserify/">BazaarJS: Module loaders e package managers - 20150628</a></p>
<blockquote>
<p>nice UMD ex</p>
</blockquote>
<p><a href="https://medium.com/the-node-js-collection/the-current-state-of-implementation-and-planning-for-esmodules-a4ecb2aac07a">The Current State of Implementation and Planning for ESModules - Node.js Foundation - 20171212</a></p>
<blockquote>
<ul>
<li>We are committed to shipping ESM</li>
<li>We are committed to ESM being first class in Node.js</li>
<li>We are committed to having the Node.js and Web platform as first class runtimes for modules. Modules installed via npm should be able to run after installation without requiring a build step.</li>
<li>We are committed to supporting our current users and offering migration paths as necessary. This can be through interoperability or APIs to improve the developer experience of working between module systems.</li>
</ul>
</blockquote>
<p><a href="https://caniuse.com/#feat=es6-module">can i use modules in browsers</a></p>
<p><a href="https://www.sitepen.com/blog/2017/10/26/state-of-modules-in-javascript/">State of Modules in JavaScript - 20171026</a></p>
<blockquote>
<p>focus on ES6 modules</p>
</blockquote>
<p><a href="https://hacks.mozilla.org/2018/03/es-modules-a-cartoon-deep-dive/">ES modules: A cartoon deep-dive - hacks.mozilla.org - 20180328</a></p>
<p><a href="https://tech.mozfr.org/post/2018/04/06/Une-plongee-illustree-dans-les-modules-ECMAScript">Une plongée illustrée dans les modules ECMAScript - tech.mozfr.org - 20180406 - trad fr de l’article précédent</a></p>
<blockquote>
<p>deep description of ES6 modules</p>
</blockquote>
<h2 id="title-why">why</h2>
<ul>
<li>linking dependencies together (in JavaScript world it is just files and it does this with global var by default)</li>
<li>encapsulation to prevent conflicts</li>
<li>managing cycling ref (A deps on B who deps on C who deps on A)</li>
<li>in regular JS import order matters and it is hard to maintain</li>
</ul>
<p>// TODO refaire les exemples avec la fonction add de lodash</p>
<h2 id="title-iife">IIFE</h2>
<p>// check <a href="http://falola.developpez.com/tutoriels/javascript/namespace/">http://falola.developpez.com/tutoriels/javascript/namespace/</a></p>
<p>// check <a href="https://zestedesavoir.com/tutoriels/358/module-pattern-en-javascript/#p83162">https://zestedesavoir.com/tutoriels/358/module-pattern-en-javascript/#p83162</a> </p>
<pre><code class="lang-javascript">
// my-module.js

var myModule = (function() {
  return {
    &quot;add&quot;: function(a, b) {
      return a + b;
    }
  };
})();

// index.js

myModule.add(1, 2); // 3</code></pre>
<h2 id="title-amd">AMD</h2>
<p>AMD is for Asynchronous Module Definition. There is <a href="https://github.com/amdjs/amdjs-api/blob/master/AMD.html">a specification</a>.</p>
<p>Main advantage over CommonJS : Async support.</p>
<p>The AMD module format itself is a proposal for defining modules where both the module and dependencies can be asynchronously loaded.</p>
<p>This is designed to be used in browsers.</p>
<p>AMD module can be JavaScript object, function, constructor, string, but also files (JSON, css, …) </p>
<pre><code class="lang-javascript">
// add.js

define([], function(){

  function add(a, b){
    return a + b;
  } 

  return {
    add: add
  };
});

// index.js

require([&#39;add&#39;], function ( add ) {
  add(1, 2); // 3
});
</code></pre>
<ul>
<li><code>define</code> method for facilitating module definition</li>
<li><code>require</code> method for handling dependency loading</li>
</ul>
<p>The <code>define</code> signature is :</p>
<pre><code class="lang-javascript">define(
    module_id /*optional*/,
    [dependencies] /*optional*/,
    definition function /*function for instantiating the module or object*/
);</code></pre>
<ul>
<li>The <code>module_id</code> string is the module name.</li>
<li>The <code>dependencies</code> array describe the deps to be injected in the <code>definition</code> function.</li>
<li>The <code>definition</code> function is a callback called by <code>define</code> when the deps are loaded.</li>
</ul>
<p>AMD has several implementation :</p>
<ul>
<li>RequireJS <a href="http://requirejs.org">http://requirejs.org</a></li>
<li>curl.js <a href="http://github.com/unscriptable/curl">http://github.com/unscriptable/curl</a></li>
<li>bdLoad <a href="http://bdframework.com/bdLoad">http://bdframework.com/bdLoad</a></li>
<li>Yabble <a href="http://github.com/jbrantly/yabble">http://github.com/jbrantly/yabble</a></li>
<li>PINF <a href="http://github.com/pinf/loader-js">http://github.com/pinf/loader-js</a></li>
</ul>
<h2 id="title-commonjs">CommonJS</h2>
<p><a href="http://www.commonjs.org/">commonjs.org</a></p>
<p>The CommonJS module proposal specifies a simple API for declaring modules server-side.</p>
<p>Main advantage over AMD : Compact declarative syntax.</p>
<ul>
<li><code>exports</code> contains the objects a module wishes to make available to other modules</li>
<li><code>require</code> function that modules can use to import the exports of other modules. </li>
</ul>
<p>CommonJS is the builtin <strong>Node.js</strong> module system.</p>
<p>A module exports can only be a JavaScript object. <a href="https://nodejs.org/dist/latest-v8.x/docs/api/modules.html#modules_module_exports">See Node.js doc</a>.</p>
<p>A module is automatically wrapped in an anonymous function :</p>
<pre><code class="lang-javascript">(function(exports, require, module, __filename, __dirname) {
// Module code actually lives in here
});</code></pre>
<p>So top level variables in a CommonJS module are scoped to the module rather than the global object. </p>
<p><a href="https://nodejs.org/dist/latest-v8.x/docs/api/modules.html#modules_the_module_wrapper">See Node.js doc</a></p>
<p>Notice that Node.js is caching exports, so if you exports a primitive, the value is copied by value. <a href="https://stackoverflow.com/questions/38972252/how-does-commonjs-make-two-copies-during-its-export-and-require-process">Cf this stackoverflow question</a>.</p>
<p><a href="http://browserify.org/">Browserify</a> is a tool built to use CommonJS for frontend development. He reads all the source files, following<br>the require instruction, and concat all files in a single one (a <em>bundle</em>) to be linked in the app.</p>
<p>The verbose AMD syntax is not needed anymore, and we can have consistency in modules definitions between frontend and backend.</p>
<pre><code class="lang-javascript">
// add.js

function add (a, b) {
    return a + b
}

module.exports = add;

// index.js

var add = require(&#39;add&#39;);

add(1, 2); // 3
</code></pre>
<h2 id="title-es6-modules">ES6 Modules</h2>
<p>The <a href="http://www.ecma-international.org/memento/TC39.htm">TC39</a> proposal for a single module definition for frontend and backen JavaScript.</p>
<pre><code class="lang-javascript">
// add.js

export function add (a, b) {
  return a + b;
}

// index.js

import { add } from &#39;./add.js&#39;;

add(1, 2); // 3
</code></pre>
<ul>
<li><code>import</code> declarations bind a modules exports as local variables and may be renamed to avoid name collisions/conflicts.</li>
<li><code>export</code> declarations declare that a local-binding of a module is externally visible such that other modules may read the exports but can’t modify them. Modules may export child modules but can’t export modules that have been defined elsewhere.</li>
</ul>
<p>ES6 creates a live read-only view of the modules we import. A primitive exposed outside with <code>export</code> is the same variable read from outside with <code>import</code>.</p>
</article></body></html>
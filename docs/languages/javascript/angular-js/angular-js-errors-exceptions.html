<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, minimal-ui"><meta name="robots" content="none"><title>marlou knowledge base</title><link href="/github-markdown.7d1fca7c.css" rel="stylesheet" media="all"><link href="/main.4b9cca7f.css" rel="stylesheet" media="all"><link href="/github.8c766760.css" rel="stylesheet"><script src="/docs.a092d0a1.js"></script></head><body><article class="markdown-body"><h1 id="title-angularjs---errors-and-exceptions">AngularJS - errors and exceptions</h1>
<h2 id="title-erreurs-dexécution-contexte-angular">Erreurs d’exécution (contexte Angular)</h2>
<p>L’[<code>$exceptionHandler</code>] (<a href="https://code.angularjs.org/1.4.9/docs/api/ng/service/$exceptionHandler">https://code.angularjs.org/1.4.9/docs/api/ng/service/$exceptionHandler</a>) catch la plupart des exceptions.<br>En tout cas toutes celles attrapées par le contexte angular.<br>Le comportement par défaut du handler est de log via <code>$log.error()</code>.</p>
<p>On peut décorer ce comportement pour affichage dans un toast, cf règle [Y110] (<a href="https://github.com/johnpapa/angular-styleguide#style-y110">https://github.com/johnpapa/angular-styleguide#style-y110</a>) du style-guide John Papa.</p>
<pre><code class="lang-javascript">/* recommended */
angular
    .module(&#39;blocks.exception&#39;)
    .config(exceptionConfig);

exceptionConfig.$inject = [&#39;$provide&#39;];

function exceptionConfig($provide) {
    $provide.decorator(&#39;$exceptionHandler&#39;, extendExceptionHandler);
}

extendExceptionHandler.$inject = [&#39;$delegate&#39;, &#39;toastr&#39;];

function extendExceptionHandler($delegate, toastr) {
    return function(exception, cause) {
        $delegate(exception, cause);
        var errorData = {
            exception: exception,
            cause: cause
        };
        /**
         * Could add the error to a service&#39;s collection,
         * add errors to $rootScope, log errors to remote web server,
         * or log locally. Or throw hard. It is entirely up to you.
         * throw exception;
         */
        toastr.error(exception.msg, errorData);
    };
}</code></pre>
<h2 id="title-erreurs-liées-aux-requêtes-http">Erreurs liées aux requêtes http</h2>
<p>L’usage d’un [interceptor http] (<a href="https://code.angularjs.org/1.4.9/docs/api/ng/service/$http#interceptors">https://code.angularjs.org/1.4.9/docs/api/ng/service/$http#interceptors</a>) permet de catcher à coup sur tous les problèmes sur toutes les requêtes exécutées à partir de $http.</p>
<pre><code class="lang-javascript">// register the interceptor as a service
$provide.factory(&#39;myHttpInterceptor&#39;, function($q, dependency1, dependency2) {
  return {
    // optional method
    &#39;request&#39;: function(config) {
      // do something on success
      return config;
    },

    // optional method
   &#39;requestError&#39;: function(rejection) {
      // do something on error
      if (canRecover(rejection)) {
        return responseOrNewPromise
      }
      return $q.reject(rejection);
    },



    // optional method
    &#39;response&#39;: function(response) {
      // do something on success
      return response;
    },

    // optional method
   &#39;responseError&#39;: function(rejection) {
      // do something on error
      if (canRecover(rejection)) {
        return responseOrNewPromise
      }
      return $q.reject(rejection);
    }
  };
});

$httpProvider.interceptors.push(&#39;myHttpInterceptor&#39;);


// alternatively, register the interceptor via an anonymous factory
$httpProvider.interceptors.push(function($q, dependency1, dependency2) {
  return {
   &#39;request&#39;: function(config) {
       // same as above
    },

    &#39;response&#39;: function(response) {
       // same as above
    }
  };
});</code></pre>
<p><strong>Restangular</strong> propose un système built-in via [setErrorInterceptor] (<a href="https://github.com/mgonto/restangular#seterrorinterceptor">https://github.com/mgonto/restangular#seterrorinterceptor</a>)</p>
<h2 id="title-erreurs-liées-au-routage">Erreurs liées au routage</h2>
<ul>
<li>routeur standard<br>cf [Y112] (<a href="https://github.com/johnpapa/angular-styleguide#style-y112">https://github.com/johnpapa/angular-styleguide#style-y112</a>) de John Papa.</li>
</ul>
<pre><code class="lang-javascript">/* recommended */
var handlingRouteChangeError = false;

function handleRoutingErrors() {
    /**
     * Route cancellation:
     * On routing error, go to the dashboard.
     * Provide an exit clause if it tries to do it twice.
     */
    $rootScope.$on(&#39;$routeChangeError&#39;,
        function(event, current, previous, rejection) {
            if (handlingRouteChangeError) { return; }
            handlingRouteChangeError = true;
            var destination = (current &amp;&amp; (current.title ||
                current.name || current.loadedTemplateUrl)) ||
                &#39;unknown target&#39;;
            var msg = &#39;Error routing to &#39; + destination + &#39;. &#39; +
                (rejection.msg || &#39;&#39;);

            /**
             * Optionally log using a custom service or $log.
             * (Don&#39;t forget to inject custom service)
             */
            logger.warning(msg, [current]);

            /**
             * On routing error, go to another route/state.
             */
            $location.path(&#39;/&#39;);

        }
    );
}</code></pre>
<ul>
<li><code>ui-router</code></li>
</ul>
<p>Cf [wiki ui-router] (<a href="https://github.com/angular-ui/ui-router/wiki#state-change-events">https://github.com/angular-ui/ui-router/wiki#state-change-events</a>).</p>
<p><strong>$stateNotFound</strong></p>
<pre><code class="lang-javascript">// somewhere, assume lazy.state has not been defined
$state.go(&quot;lazy.state&quot;, {a:1, b:2}, {inherit:false});

// somewhere else
$rootScope.$on(&#39;$stateNotFound&#39;, 
function(event, unfoundState, fromState, fromParams){ 
    console.log(unfoundState.to); // &quot;lazy.state&quot;
    console.log(unfoundState.toParams); // {a:1, b:2}
    console.log(unfoundState.options); // {inherit:false} + default options
})</code></pre>
<p><strong>$stateChangeError</strong></p>
<pre><code class="lang-javascript">$rootScope.$on(&#39;$stateChangeError&#39;, 
function(event, toState, toParams, fromState, fromParams, error){ ... })</code></pre>
</article></body></html>
<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, minimal-ui"><meta name="robots" content="none"><title>marlou knowledge base</title><link href="/github-markdown.d098492d.css" rel="stylesheet" media="all"><link href="/main.cb64a04a.css" rel="stylesheet" media="all"><link href="/github.51c27d45.css" rel="stylesheet"><script src="/docs.a0c71561.js"></script></head><body><article class="markdown-body"><h1 id="title-java---play---pojo-validation">java - play - pojo validation</h1> <p><a href="http://www.playframework.com/documentation/2.2.x/JavaForms">http://www.playframework.com/documentation/2.2.x/JavaForms</a></p> <p><a href="http://docs.spring.io/spring/docs/3.0.x/reference/validation.html">http://docs.spring.io/spring/docs/3.0.x/reference/validation.html</a></p> <p>checker JSR-303 (Bean Validation)</p> <p><a href="http://blog.octo.com/jsr-303-bean-validation-etat-des-lieux/">http://blog.octo.com/jsr-303-bean-validation-etat-des-lieux/</a></p> <p>check des raw types :</p> <pre><code class="lang-java">@NotNull
@Constraints.Required
@Constraints.MinLength(value = 5)
@Constraints.MaxLength(value = 20)
private String name;
@Nullable
@Formats.DateTime(pattern = &quot;yyyy/MM/dd HH:mm:ss&quot;)
@JsonFormat(shape=JsonFormat.Shape.STRING, pattern=&quot;yyyy/MM/dd HH:mm:ss&quot;, timezone=&quot;CET&quot;)
private Date date;
@NotNull
@Constraints.Required
@Constraints.Min(value = 1)
@Constraints.Max(value = 10)
private Integer numberInteger;
@Nullable
@Constraints.Min(value = 10)
@Constraints.Max(value = 20)
private Long numberLong;</code></pre> <p>SQL version :</p> <pre><code class="lang-sql">`date` datetime DEFAULT NULL,
`name` varchar(255) DEFAULT NULL,
`numberInteger` int(11) DEFAULT NULL,
`numberLong` bigint(20) DEFAULT NULL,</code></pre> <p>unit test :</p> <pre><code class="lang-java">package models;


import com.fasterxml.jackson.databind.JsonNode;
import org.junit.Assert;
import org.junit.Before;
import org.junit.Test;
import org.myweb.utils.test.TestHelper;
import play.data.Form;
import play.data.validation.ValidationError;
import play.libs.Json;

import java.util.List;
import java.util.Map;

public class ProductValidationTest {

    Product validProduct;

    @Before
    public void setUp() throws Exception {

        validProduct = TestHelper.productFactory(null, &quot;boubouboubou&quot;, null, 10, 10l, null);
    }

    @Test
    public void testProductValidation_OK() {

        JsonNode jsProduct = Json.toJson(validProduct);

        Form&lt;Product&gt; productForm = Form.form(Product.class);
        productForm = productForm.bind(jsProduct);

        Assert.assertFalse(productForm.hasErrors());
    }

    @Test
    public void testProductValidation_KO_requiredFields() {

        //noinspection ConstantConditions
        validProduct.setName(null);
        //noinspection ConstantConditions
        validProduct.setNumberInteger(null);
        //noinspection ConstantConditions
        validProduct.setCategory(null);

        JsonNode jsProduct = Json.toJson(validProduct);

        Form&lt;Product&gt; productForm = Form.form(Product.class);
        productForm = productForm.bind(jsProduct);

        Assert.assertTrue(productForm.hasErrors());

        Map&lt;String,List&lt;ValidationError&gt;&gt; errors = productForm.errors();
        Assert.assertNotNull(errors);
        Assert.assertTrue(errors.size() &gt; 0);

        List&lt;ValidationError&gt; fieldErrors;
        ValidationError fieldError;

        fieldErrors = errors.get(&quot;name&quot;);
        Assert.assertNotNull(fieldErrors);
        Assert.assertTrue(fieldErrors.size() &gt; 0);
        fieldError = fieldErrors.get(0);
        Assert.assertEquals(&quot;error.required&quot;, fieldError.message());

        fieldErrors = errors.get(&quot;numberInteger&quot;);
        Assert.assertNotNull(fieldErrors);
        Assert.assertTrue(fieldErrors.size() &gt; 0);
        fieldError = fieldErrors.get(0);
        Assert.assertEquals(&quot;error.required&quot;, fieldError.message());
    }

    @Test
    public void testProductValidation_KO_stringsMinLengths() {

        validProduct.setName(&quot;toto&quot;);

        JsonNode jsProduct = Json.toJson(validProduct);

        Form&lt;Product&gt; productForm = Form.form(Product.class);
        productForm = productForm.bind(jsProduct);

        Assert.assertTrue(productForm.hasErrors());

        Map&lt;String,List&lt;ValidationError&gt;&gt; errors = productForm.errors();
        Assert.assertNotNull(errors);
        Assert.assertTrue(errors.size() &gt; 0);

        List&lt;ValidationError&gt; fieldErrors;
        ValidationError fieldError;

        fieldErrors = errors.get(&quot;name&quot;);
        Assert.assertNotNull(fieldErrors);
        Assert.assertTrue(fieldErrors.size() &gt; 0);
        fieldError = fieldErrors.get(0);
        Assert.assertEquals(&quot;error.minLength&quot;, fieldError.message());

        validProduct.setName(&quot;totototototototototototototototototototototototototototototototototototo&quot;);
    }

    @Test
    public void testProductValidation_KO_stringsMaxLengths() {

        validProduct.setName(&quot;totototototototototototototototototototototototototototototototototototo&quot;);

        JsonNode jsProduct = Json.toJson(validProduct);

        Form&lt;Product&gt; productForm = Form.form(Product.class);
        productForm = productForm.bind(jsProduct);

        Assert.assertTrue(productForm.hasErrors());

        Map&lt;String,List&lt;ValidationError&gt;&gt; errors = productForm.errors();
        Assert.assertNotNull(errors);
        Assert.assertTrue(errors.size() &gt; 0);

        List&lt;ValidationError&gt; fieldErrors;
        ValidationError fieldError;

        fieldErrors = errors.get(&quot;name&quot;);
        Assert.assertNotNull(fieldErrors);
        Assert.assertTrue(fieldErrors.size() &gt; 0);
        fieldError = fieldErrors.get(0);
        Assert.assertEquals(&quot;error.maxLength&quot;, fieldError.message());
    }

    @Test
    public void testProductValidation_KO_numericMin() {

        validProduct.setNumberInteger(0);
        validProduct.setNumberLong(9l);

        JsonNode jsProduct = Json.toJson(validProduct);

        Form&lt;Product&gt; productForm = Form.form(Product.class);
        productForm = productForm.bind(jsProduct);

        Assert.assertTrue(productForm.hasErrors());

        Map&lt;String,List&lt;ValidationError&gt;&gt; errors = productForm.errors();
        Assert.assertNotNull(errors);
        Assert.assertTrue(errors.size() &gt; 0);

        List&lt;ValidationError&gt; fieldErrors;
        ValidationError fieldError;

        fieldErrors = errors.get(&quot;numberInteger&quot;);
        Assert.assertNotNull(fieldErrors);
        Assert.assertTrue(fieldErrors.size() &gt; 0);
        fieldError = fieldErrors.get(0);
        Assert.assertEquals(&quot;error.min&quot;, fieldError.message());

        fieldErrors = errors.get(&quot;numberLong&quot;);
        Assert.assertNotNull(fieldErrors);
        Assert.assertTrue(fieldErrors.size() &gt; 0);
        fieldError = fieldErrors.get(0);
        Assert.assertEquals(&quot;error.min&quot;, fieldError.message());
    }

    @Test
    public void testProductValidation_KO_numericMax() {

        validProduct.setNumberInteger(11);
        validProduct.setNumberLong(21l);

        JsonNode jsProduct = Json.toJson(validProduct);

        Form&lt;Product&gt; productForm = Form.form(Product.class);
        productForm = productForm.bind(jsProduct);

        Assert.assertTrue(productForm.hasErrors());

        Map&lt;String,List&lt;ValidationError&gt;&gt; errors = productForm.errors();
        Assert.assertNotNull(errors);
        Assert.assertTrue(errors.size() &gt; 0);

        List&lt;ValidationError&gt; fieldErrors;
        ValidationError fieldError;

        fieldErrors = errors.get(&quot;numberInteger&quot;);
        Assert.assertNotNull(fieldErrors);
        Assert.assertTrue(fieldErrors.size() &gt; 0);
        fieldError = fieldErrors.get(0);
        Assert.assertEquals(&quot;error.max&quot;, fieldError.message());

        fieldErrors = errors.get(&quot;numberLong&quot;);
        Assert.assertNotNull(fieldErrors);
        Assert.assertTrue(fieldErrors.size() &gt; 0);
        fieldError = fieldErrors.get(0);
        Assert.assertEquals(&quot;error.max&quot;, fieldError.message());
    }
}</code></pre> </article></body></html>